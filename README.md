# Description
競馬予想ソフトを自作しました。現在（2021/5/16）は西田式スピード指数を使用しています。

# Expected result!
## ユニコーンS(2021/6/20)
```
1st : ルーチェドーロ&戸崎圭(90.72)
2nd : ティアップリオン&内田博(87.58)
3rd : プロバーティオ&Ｍデムーロ(87.42)
4th : ケイアイロベージ&三浦(86.34)
```
## マーメイドS(2021/6/20)
```
1st : シャドウディーヴァ&福永(90.87)
2nd : サンクテュエール&川田(89.16)
3rd : カセドラルベル&和田竜(88.07)
4th : レッドベルディエス&幸(87.81)
```

# Usage
## Web scraping
```
$ python update_database.py
```
データベースの作成及び更新を行います。
## Prediction
```
$ python pred_nishida.py
```
データから予想を行います。

# Note
## スピード指数について
- 今回は、馬とジョッキーそれぞれに対してスピード指数を求め、足して2で割った値を用いて順位を予想しています。
- スピード指数に使用したベースタイムは、「指定の競馬場　かつ　指定の距離　かつ　指定のグラウンド（芝orダートor障害）　かつ　1,2,3勝クラス」といった条件に一致する全レースの平均タイムとしています。
- スピード指数に使用した馬場指数は、「指定の競馬場　かつ　指定の距離　かつ　指定のグラウンド（芝orダートor障害）　かつ　指定の天候」といった条件に一致するデータのみを用いて計算を行っています。データ数が多かろうが少なかろうがとりあえず標準正規分布を仮定して、分布上での「条件下の平均タイム」と「ベースタイム」の差×10を馬場指数として使用しています。データ数が1以下である（分散がゼロになる）場合は、スピード指数を計算していません。
- ジョッキーのスピード指数は、直近150試合のレース結果から算出しています。（「日本ダービーでの更新点」を参照のこと）
## エプソムCでの更新点
- 出走馬の血統情報から距離適性を考慮できるようになりました。
- 父親、父方の祖父、母方の祖父の産駒が出走したレース結果からスピード指数を計算しました。
- 使用した産駒レース結果は、父親、父方の祖父、母方の祖父それぞれの産駒獲得賞金上位100頭から取得しました。
- 産駒レース結果の中から、さらに、距離が開催レースの距離±400mのレース結果をスピード指数計算に使用しました。
## 安田記念での更新点
- データベースをCSVからSQLに変更しました。
- 馬場指数とベースタイムの計算速度が向上。
- データベースの作成・更新が簡単になりました。（update_database.pyを実行すればよい）
## 日本ダービーでの更新点
- 開催レースの情報（距離及び芝orダートor障害）を反映できるようになりました。
- 開催レースと同様の距離及び芝orダートor障害のレースから、ジョッキーのスピード指数を計算しました。
- 馬のほうにも反映するべきだと思いますが、データ数が少なすぎる・・・。将来的には、血統データから距離適性を計算したいですね。（Referencesの4行目を参照のこと）
## オークスでの更新点
- 全体の計算速度が向上しました。
- データベースを使用して、計算したことのある馬場指数とベースタイムを保存しました。
## ヴィクトリアMでの更新点
- ジョッキーのスピード指数を考慮しました。
- 馬だけでなく、ジョッキーの良し悪しもレースに影響を与えるのではないかと思って！

# References
- https://zenn.dev/kami/articles/66e400c8a43cd08a5d7f#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%8C%E5%BE%97%E3%82%89%E3%82%8C%E3%81%9F%E3%82%89%E6%95%B4%E5%BD%A2%E3%83%BB%E5%88%86%E6%9E%90%E3%82%92%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%81%8F
- https://sites.google.com/site/masashikameda/%E3%82%B9%E3%83%94%E3%83%BC%E3%83%89%E6%8C%87%E6%95%B0%E3%81%A8%E5%9F%BA%E6%BA%96%E5%80%A4
- http://www.rightniks.ne.jp/index.php?action=whatspidx_contents&name=sikumi
- https://shiromaru-life.com/keiba-distance-ranking/